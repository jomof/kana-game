{"version":3,"file":"tokenize.js","sourceRoot":"","sources":["src/tokenize.ts"],"names":[],"mappings":"AAAA;;;;GAIG;AAEH,OAAO,KAAK,QAAQ,MAAM,iBAAiB,CAAC;AAE5C,MAAM,MAAM,GAA0B;IACpC,KAAK,CAAC,eAAe,CAAC,GAAW;QAC/B,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QAC/B,MAAM,GAAG,GAAG,MAAM,KAAK,CACrB,0DAA0D,GAAG,GAAG,CACjE,CAAC;QACF,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC;YACZ,MAAM,IAAI,KAAK,CAAC,mBAAmB,GAAG,KAAK,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC;QAC3D,CAAC;QACD,OAAO,GAAG,CAAC,WAAW,EAAE,CAAC;IAC3B,CAAC;CACF,CAAC;AAEF,IAAI,gBAAgB,GAAwE,IAAI,CAAC;AAEjG,SAAS,YAAY;IACnB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACtB,OAAO,CAAC,GAAG,CAAC,oCAAoC,CAAC,CAAC;QAClD,gBAAgB,GAAG,IAAI,QAAQ,CAAC,gBAAgB,CAAC,EAAC,MAAM,EAAC,CAAC,CAAC,KAAK,EAAE,CAAC;IACrE,CAAC;IACD,OAAO,gBAAgB,CAAC;AAC1B,CAAC;AAID,MAAM,eAAe,GAAgB,KAAK,EAAE,IAAY,EAAE,EAAE;IAC1D,IAAI,CAAC;QACH,MAAM,SAAS,GAAG,MAAM,YAAY,EAAE,CAAC;QACvC,OAAO,SAAS,CAAC,QAAQ,CAAC,IAAI,CAA8B,CAAC;IAC/D,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAE,KAAK,CAAC,CAAC;QAC7C,MAAM,KAAK,CAAC;IACd,CAAC;AACH,CAAC,CAAC;AAEF,IAAI,YAAY,GAAgB,eAAe,CAAC;AAEhD,MAAM,CAAC,MAAM,QAAQ,GAAgB,CAAC,IAAI,EAAE,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;AAElE,MAAM,UAAU,YAAY,CAAC,EAAe;IAC1C,YAAY,GAAG,EAAE,CAAC;AACpB,CAAC;AAED,MAAM,UAAU,cAAc;IAC5B,YAAY,GAAG,eAAe,CAAC;AACjC,CAAC","sourcesContent":["/**\n * @license\n * Copyright 2025 Jomo Fisher\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport * as kuromoji from '@patdx/kuromoji';\n\nconst loader: kuromoji.LoaderConfig = {\n  async loadArrayBuffer(url: string): Promise<ArrayBufferLike> {\n    url = url.replace(/\\.gz$/, '');\n    const res = await fetch(\n      'https://cdn.jsdelivr.net/npm/@aiktb/kuromoji@1.0.2/dict/' + url\n    );\n    if (!res.ok) {\n      throw new Error(`Failed to fetch ${url}: ${res.status}`);\n    }\n    return res.arrayBuffer();\n  },\n};\n\nlet tokenizerPromise: ReturnType<typeof kuromoji.TokenizerBuilder.prototype.build> | null = null;\n\nfunction getTokenizer() {\n  if (!tokenizerPromise) {\n    console.log('Initializing kuromoji tokenizer...');\n    tokenizerPromise = new kuromoji.TokenizerBuilder({loader}).build();\n  }\n  return tokenizerPromise;\n}\n\nexport type TokenizerFn = (text: string) => Promise<kuromoji.IpadicFeatures[]>;\n\nconst defaultTokenize: TokenizerFn = async (text: string) => {\n  try {\n    const tokenizer = await getTokenizer();\n    return tokenizer.tokenize(text) as kuromoji.IpadicFeatures[];\n  } catch (error) {\n    console.error('Tokenization failed:', error);\n    throw error;\n  }\n};\n\nlet tokenizeImpl: TokenizerFn = defaultTokenize;\n\nexport const tokenize: TokenizerFn = (text) => tokenizeImpl(text);\n\nexport function setTokenizer(fn: TokenizerFn) {\n  tokenizeImpl = fn;\n}\n\nexport function resetTokenizer() {\n  tokenizeImpl = defaultTokenize;\n}\n"]}