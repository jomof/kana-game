/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const t=globalThis,n=t.ShadowRoot&&(void 0===t.ShadyCSS||t.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),e=new WeakMap;let s=class{constructor(t,n,e){if(this._$cssResult$=!0,e!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=n}get styleSheet(){let t=this.o;const i=this.t;if(n&&void 0===t){const n=void 0!==i&&1===i.length;n&&(t=e.get(i)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&e.set(i,t))}return t}toString(){return this.cssText}};const r=(t,...n)=>{const e=1===t.length?t[0]:n.reduce((n,i,e)=>n+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[e+1],t[0]);return new s(e,t,i)},o=n?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let n="";for(const i of t.cssRules)n+=i.cssText;return(t=>new s("string"==typeof t?t:t+"",void 0,i))(n)})(t):t,{is:c,defineProperty:u,getOwnPropertyDescriptor:a,getOwnPropertyNames:h,getOwnPropertySymbols:l,getPrototypeOf:f}=Object,d=globalThis,p=d.trustedTypes,w=p?p.emptyScript:"",y=d.reactiveElementPolyfillSupport,g=(t,n)=>t,b={toAttribute(t,n){switch(n){case Boolean:t=t?w:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,n){let i=t;switch(n){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},m=(t,n)=>!c(t,n),v={attribute:!0,type:String,converter:b,reflect:!1,useDefault:!1,hasChanged:m};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */Symbol.metadata??=Symbol("metadata"),d.litPropertyMetadata??=new WeakMap;let k=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,n=v){if(n.state&&(n.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((n=Object.create(n)).wrapped=!0),this.elementProperties.set(t,n),!n.noAccessor){const i=Symbol(),e=this.getPropertyDescriptor(t,i,n);void 0!==e&&u(this.prototype,t,e)}}static getPropertyDescriptor(t,n,i){const{get:e,set:s}=a(this.prototype,t)??{get(){return this[n]},set(t){this[n]=t}};return{get:e,set(n){const r=e?.call(this);s?.call(this,n),this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??v}static _$Ei(){if(this.hasOwnProperty(g("elementProperties")))return;const t=f(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(g("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(g("properties"))){const t=this.properties,n=[...h(t),...l(t)];for(const i of n)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const n=litPropertyMetadata.get(t);if(void 0!==n)for(const[t,i]of n)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,n]of this.elementProperties){const i=this._$Eu(t,n);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const n=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)n.unshift(o(t))}else void 0!==t&&n.push(o(t));return n}static _$Eu(t,n){const i=n.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(t=>t(this))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,n=this.constructor.elementProperties;for(const i of n.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const i=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((i,e)=>{if(n)i.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const n of e){const e=document.createElement("style"),s=t.litNonce;void 0!==s&&e.setAttribute("nonce",s),e.textContent=n.cssText,i.appendChild(e)}})(i,this.constructor.elementStyles),i}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(t=>t.hostConnected?.())}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach(t=>t.hostDisconnected?.())}attributeChangedCallback(t,n,i){this._$AK(t,i)}_$ET(t,n){const i=this.constructor.elementProperties.get(t),e=this.constructor._$Eu(t,i);if(void 0!==e&&!0===i.reflect){const s=(void 0!==i.converter?.toAttribute?i.converter:b).toAttribute(n,i.type);this._$Em=t,null==s?this.removeAttribute(e):this.setAttribute(e,s),this._$Em=null}}_$AK(t,n){const i=this.constructor,e=i._$Eh.get(t);if(void 0!==e&&this._$Em!==e){const t=i.getPropertyOptions(e),s="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:b;this._$Em=e;const r=s.fromAttribute(n,t.type);this[e]=r??this._$Ej?.get(e)??r,this._$Em=null}}requestUpdate(t,n,i){if(void 0!==t){const e=this.constructor,s=this[t];if(i??=e.getPropertyOptions(t),!((i.hasChanged??m)(s,n)||i.useDefault&&i.reflect&&s===this._$Ej?.get(t)&&!this.hasAttribute(e._$Eu(t,i))))return;this.C(t,n,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(t,n,{useDefault:i,reflect:e,wrapped:s},r){i&&!(this._$Ej??=new Map).has(t)&&(this._$Ej.set(t,r??n??this[t]),!0!==s||void 0!==r)||(this._$AL.has(t)||(this.hasUpdated||i||(n=void 0),this._$AL.set(t,n)),!0===e&&this._$Em!==t&&(this._$Eq??=new Set).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,n]of this._$Ep)this[t]=n;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[n,i]of t){const{wrapped:t}=i,e=this[n];!0!==t||this._$AL.has(n)||void 0===e||this.C(n,void 0,i,e)}}let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),this._$EO?.forEach(t=>t.hostUpdate?.()),this.update(n)):this._$EM()}catch(n){throw t=!1,this._$EM(),n}t&&this._$AE(n)}willUpdate(t){}_$AE(t){this._$EO?.forEach(t=>t.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&=this._$Eq.forEach(t=>this._$ET(t,this[t])),this._$EM()}updated(t){}firstUpdated(t){}};k.elementStyles=[],k.shadowRootOptions={mode:"open"},k[g("elementProperties")]=new Map,k[g("finalized")]=new Map,y?.({ReactiveElement:k}),(d.reactiveElementVersions??=[]).push("2.1.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const O=globalThis,S=O.trustedTypes,$=S?S.createPolicy("lit-html",{createHTML:t=>t}):void 0,_="$lit$",j=`lit$${Math.random().toFixed(9).slice(2)}$`,A="?"+j,C=`<${A}>`,x=document,E=()=>x.createComment(""),N=t=>null===t||"object"!=typeof t&&"function"!=typeof t,z=Array.isArray,U="[ \t\n\f\r]",M=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,I=/-->/g,P=/>/g,T=RegExp(`>|${U}(?:([^\\s"'>=/]+)(${U}*=${U}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),B=/'/g,D=/"/g,J=/^(?:script|style|textarea|title)$/i,R=(t=>(n,...i)=>({_$litType$:t,strings:n,values:i}))(1),F=Symbol.for("lit-noChange"),K=Symbol.for("lit-nothing"),q=new WeakMap,L=x.createTreeWalker(x,129);function W(t,n){if(!z(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==$?$.createHTML(n):n}const H=(t,n)=>{const i=t.length-1,e=[];let s,r=2===n?"<svg>":3===n?"<math>":"",o=M;for(let n=0;n<i;n++){const i=t[n];let c,u,a=-1,h=0;for(;h<i.length&&(o.lastIndex=h,u=o.exec(i),null!==u);)h=o.lastIndex,o===M?"!--"===u[1]?o=I:void 0!==u[1]?o=P:void 0!==u[2]?(J.test(u[2])&&(s=RegExp("</"+u[2],"g")),o=T):void 0!==u[3]&&(o=T):o===T?">"===u[0]?(o=s??M,a=-1):void 0===u[1]?a=-2:(a=o.lastIndex-u[2].length,c=u[1],o=void 0===u[3]?T:'"'===u[3]?D:B):o===D||o===B?o=T:o===I||o===P?o=M:(o=T,s=void 0);const l=o===T&&t[n+1].startsWith("/>")?" ":"";r+=o===M?i+C:a>=0?(e.push(c),i.slice(0,a)+_+i.slice(a)+j+l):i+j+(-2===a?n:l)}return[W(t,r+(t[i]||"<?>")+(2===n?"</svg>":3===n?"</math>":"")),e]};class V{constructor({strings:t,_$litType$:n},i){let e;this.parts=[];let s=0,r=0;const o=t.length-1,c=this.parts,[u,a]=H(t,n);if(this.el=V.createElement(u,i),L.currentNode=this.el.content,2===n||3===n){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(e=L.nextNode())&&c.length<o;){if(1===e.nodeType){if(e.hasAttributes())for(const t of e.getAttributeNames())if(t.endsWith(_)){const n=a[r++],i=e.getAttribute(t).split(j),o=/([.?@])?(.*)/.exec(n);c.push({type:1,index:s,name:o[2],strings:i,ctor:"."===o[1]?Y:"?"===o[1]?tt:"@"===o[1]?nt:X}),e.removeAttribute(t)}else t.startsWith(j)&&(c.push({type:6,index:s}),e.removeAttribute(t));if(J.test(e.tagName)){const t=e.textContent.split(j),n=t.length-1;if(n>0){e.textContent=S?S.emptyScript:"";for(let i=0;i<n;i++)e.append(t[i],E()),L.nextNode(),c.push({type:2,index:++s});e.append(t[n],E())}}}else if(8===e.nodeType)if(e.data===A)c.push({type:2,index:s});else{let t=-1;for(;-1!==(t=e.data.indexOf(j,t+1));)c.push({type:7,index:s}),t+=j.length-1}s++}}static createElement(t,n){const i=x.createElement("template");return i.innerHTML=t,i}}function G(t,n,i=t,e){if(n===F)return n;let s=void 0!==e?i._$Co?.[e]:i._$Cl;const r=N(n)?void 0:n._$litDirective$;return s?.constructor!==r&&(s?._$AO?.(!1),void 0===r?s=void 0:(s=new r(t),s._$AT(t,i,e)),void 0!==e?(i._$Co??=[])[e]=s:i._$Cl=s),void 0!==s&&(n=G(t,s._$AS(t,n.values),s,e)),n}class Q{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:n},parts:i}=this._$AD,e=(t?.creationScope??x).importNode(n,!0);L.currentNode=e;let s=L.nextNode(),r=0,o=0,c=i[0];for(;void 0!==c;){if(r===c.index){let n;2===c.type?n=new Z(s,s.nextSibling,this,t):1===c.type?n=new c.ctor(s,c.name,c.strings,this,t):6===c.type&&(n=new it(s,this,t)),this._$AV.push(n),c=i[++o]}r!==c?.index&&(s=L.nextNode(),r++)}return L.currentNode=x,e}p(t){let n=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class Z{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,n,i,e){this.type=2,this._$AH=K,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=e,this._$Cv=e?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return void 0!==n&&11===t?.nodeType&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=G(this,t,n),N(t)?t===K||null==t||""===t?(this._$AH!==K&&this._$AR(),this._$AH=K):t!==this._$AH&&t!==F&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>z(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==K&&N(this._$AH)?this._$AA.nextSibling.data=t:this.T(x.createTextNode(t)),this._$AH=t}$(t){const{values:n,_$litType$:i}=t,e="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=V.createElement(W(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===e)this._$AH.p(n);else{const t=new Q(e,this),i=t.u(this.options);t.p(n),this.T(i),this._$AH=t}}_$AC(t){let n=q.get(t.strings);return void 0===n&&q.set(t.strings,n=new V(t)),n}k(t){z(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,e=0;for(const s of t)e===n.length?n.push(i=new Z(this.O(E()),this.O(E()),this,this.options)):i=n[e],i._$AI(s),e++;e<n.length&&(this._$AR(i&&i._$AB.nextSibling,e),n.length=e)}_$AR(t=this._$AA.nextSibling,n){for(this._$AP?.(!1,!0,n);t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class X{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,n,i,e,s){this.type=1,this._$AH=K,this._$AN=void 0,this.element=t,this.name=n,this._$AM=e,this.options=s,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=K}_$AI(t,n=this,i,e){const s=this.strings;let r=!1;if(void 0===s)t=G(this,t,n,0),r=!N(t)||t!==this._$AH&&t!==F,r&&(this._$AH=t);else{const e=t;let o,c;for(t=s[0],o=0;o<s.length-1;o++)c=G(this,e[i+o],n,o),c===F&&(c=this._$AH[o]),r||=!N(c)||c!==this._$AH[o],c===K?t=K:t!==K&&(t+=(c??"")+s[o+1]),this._$AH[o]=c}r&&!e&&this.j(t)}j(t){t===K?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Y extends X{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===K?void 0:t}}class tt extends X{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==K)}}class nt extends X{constructor(t,n,i,e,s){super(t,n,i,e,s),this.type=5}_$AI(t,n=this){if((t=G(this,t,n,0)??K)===F)return;const i=this._$AH,e=t===K&&i!==K||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==K&&(i===K||e);e&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}}class it{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){G(this,t)}}const et=O.litHtmlPolyfillSupport;et?.(V,Z),(O.litHtmlVersions??=[]).push("3.3.1");const st=globalThis;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class rt extends k{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const n=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,n,i)=>{const e=i?.renderBefore??n;let s=e._$litPart$;if(void 0===s){const t=i?.renderBefore??null;e._$litPart$=s=new Z(n.insertBefore(E(),t),t,void 0,i??{})}return s._$AI(t),s})(n,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return F}}rt._$litElement$=!0,rt.finalized=!0,st.litElementHydrateSupport?.({LitElement:rt});const ot=st.litElementPolyfillSupport;ot?.({LitElement:rt}),(st.litElementVersions??=[]).push("4.2.1");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ct={attribute:!0,type:String,converter:b,reflect:!1,hasChanged:m},ut=(t=ct,n,i)=>{const{kind:e,metadata:s}=i;let r=globalThis.litPropertyMetadata.get(s);if(void 0===r&&globalThis.litPropertyMetadata.set(s,r=new Map),"setter"===e&&((t=Object.create(t)).wrapped=!0),r.set(i.name,t),"accessor"===e){const{name:e}=i;return{set(i){const s=n.get.call(this);n.set.call(this,i),this.requestUpdate(e,s,t)},init(n){return void 0!==n&&this.C(e,void 0,t,n),n}}}if("setter"===e){const{name:e}=i;return function(i){const s=this[e];n.call(this,i),this.requestUpdate(e,s,t)}}throw Error("Unsupported decorator location: "+e)};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function at(t){return(n,i)=>"object"==typeof i?ut(t,n,i):((t,n,i)=>{const e=n.hasOwnProperty(i);return n.constructor.createProperty(i,t),e?Object.getOwnPropertyDescriptor(n,i):void 0})(t,n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ht(t){return at({...t,state:!0,attribute:!1})}function lt(t){return null===t?"null":t!==Object(t)?typeof t:{}.toString.call(t).slice(8,-1).toLowerCase()}function ft(t){return"string"!==lt(t)||!t.length}function dt(t="",n,i){if(ft(t))return!1;const e=t.charCodeAt(0);return n<=e&&e<=i}const pt="toHiragana",wt="toKatakana",yt="hepburn",gt={useObsoleteKana:!1,passRomaji:!1,convertLongVowelMark:!0,upcaseKatakana:!1,IMEMode:!1,romanization:yt},bt=[65377,65381],mt=[...[[12352,12447],[12448,12543],bt,[65382,65439]],...[[12288,12351],bt,[12539,12540],[65281,65295],[65306,65311],[65339,65343],[65371,65376],[65504,65518]],[65313,65338],[65345,65370],[65296,65305],[19968,40959],[13312,19903]],vt=[[0,127],[256,257],[274,275],[298,299],[332,333],[362,363]],kt=[[32,47],[58,63],[91,96],[123,126],[8216,8217],[8220,8221]];function Ot(t="",n){const i="regexp"===lt(n);return!ft(t)&&[...t].every(t=>{const e=function(t=""){return mt.some(([n,i])=>dt(t,n,i))}(t);return i?e||n.test(t):e})}var St=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function $t(t,n){return t===n||!(!St(t)||!St(n))}function _t(t,n){if(t.length!==n.length)return!1;for(var i=0;i<t.length;i++)if(!$t(t[i],n[i]))return!1;return!0}function jt(t,n){void 0===n&&(n=_t);var i=null;function e(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];if(i&&i.lastThis===this&&n(e,i.lastArgs))return i.lastResult;var r=t.apply(this,e);return i={lastResult:r,lastArgs:e,lastThis:this},r}return e.clear=function(){i=null},e}var At=Object.prototype.hasOwnProperty;function Ct(t,n,i){for(i of t.keys())if(xt(i,n))return i}function xt(t,n){var i,e,s;if(t===n)return!0;if(t&&n&&(i=t.constructor)===n.constructor){if(i===Date)return t.getTime()===n.getTime();if(i===RegExp)return t.toString()===n.toString();if(i===Array){if((e=t.length)===n.length)for(;e--&&xt(t[e],n[e]););return-1===e}if(i===Set){if(t.size!==n.size)return!1;for(e of t){if((s=e)&&"object"==typeof s&&!(s=Ct(n,s)))return!1;if(!n.has(s))return!1}return!0}if(i===Map){if(t.size!==n.size)return!1;for(e of t){if((s=e[0])&&"object"==typeof s&&!(s=Ct(n,s)))return!1;if(!xt(e[1],n.get(s)))return!1}return!0}if(i===ArrayBuffer)t=new Uint8Array(t),n=new Uint8Array(n);else if(i===DataView){if((e=t.byteLength)===n.byteLength)for(;e--&&t.getInt8(e)===n.getInt8(e););return-1===e}if(ArrayBuffer.isView(t)){if((e=t.byteLength)===n.byteLength)for(;e--&&t[e]===n[e];);return-1===e}if(!i||"object"==typeof t){for(i in e=0,t){if(At.call(t,i)&&++e&&!At.call(n,i))return!1;if(!(i in n)||!xt(t[i],n[i]))return!1}return Object.keys(n).length===e}}return t!=t&&n!=n}const Et=(t={})=>Object.assign({},gt,t);function Nt(t,n,i){const e=n;function s(t,n){const i=t.charAt(0);return r(Object.assign({"":i},e[i]),t.slice(1),n,n+1)}function r(t,n,e,o){if(!n)return i||1===Object.keys(t).length?t[""]?[[e,o,t[""]]]:[]:[[e,o,null]];if(1===Object.keys(t).length)return[[e,o,t[""]]].concat(s(n,o));const c=function(t,n){if(void 0!==t[n])return Object.assign({"":t[""]+n},t[n])}(t,n.charAt(0));return void 0===c?[[e,o,t[""]]].concat(s(n,o)):r(c,n.slice(1),e,o+1)}return s(t,0)}function zt(t){return Object.entries(t).reduce((t,[n,i])=>{const e="string"===lt(i);return t[n]=e?{"":i}:zt(i),t},{})}function Ut(t,n){return n.split("").reduce((t,n)=>(void 0===t[n]&&(t[n]={}),t[n]),t)}function Mt(t={}){const n={};return"object"===lt(t)&&Object.entries(t).forEach(([t,i])=>{let e=n;t.split("").forEach(t=>{void 0===e[t]&&(e[t]={}),e=e[t]}),e[""]=i}),function(t){return function t(n,i){return void 0===n||"string"===lt(n)?i:Object.entries(i).reduce((i,[e,s])=>(i[e]=t(n[e],s),i),n)}(JSON.parse(JSON.stringify(t)),n)}}function It(t,n){return n?"function"===lt(n)?n(t):Mt(n)(t):t}const Pt={a:"あ",i:"い",u:"う",e:"え",o:"お",k:{a:"か",i:"き",u:"く",e:"け",o:"こ"},s:{a:"さ",i:"し",u:"す",e:"せ",o:"そ"},t:{a:"た",i:"ち",u:"つ",e:"て",o:"と"},n:{a:"な",i:"に",u:"ぬ",e:"ね",o:"の"},h:{a:"は",i:"ひ",u:"ふ",e:"へ",o:"ほ"},m:{a:"ま",i:"み",u:"む",e:"め",o:"も"},y:{a:"や",u:"ゆ",o:"よ"},r:{a:"ら",i:"り",u:"る",e:"れ",o:"ろ"},w:{a:"わ",i:"ゐ",e:"ゑ",o:"を"},g:{a:"が",i:"ぎ",u:"ぐ",e:"げ",o:"ご"},z:{a:"ざ",i:"じ",u:"ず",e:"ぜ",o:"ぞ"},d:{a:"だ",i:"ぢ",u:"づ",e:"で",o:"ど"},b:{a:"ば",i:"び",u:"ぶ",e:"べ",o:"ぼ"},p:{a:"ぱ",i:"ぴ",u:"ぷ",e:"ぺ",o:"ぽ"},v:{a:"ゔぁ",i:"ゔぃ",u:"ゔ",e:"ゔぇ",o:"ゔぉ"}},Tt={".":"。",",":"、",":":"：","/":"・","!":"！","?":"？","~":"〜","-":"ー","‘":"「","’":"」","“":"『","”":"』","[":"［","]":"］","(":"（",")":"）","{":"｛","}":"｝"},Bt={k:"き",s:"し",t:"ち",n:"に",h:"ひ",m:"み",r:"り",g:"ぎ",z:"じ",d:"ぢ",b:"び",p:"ぴ",v:"ゔ",q:"く",f:"ふ"},Dt={ya:"ゃ",yi:"ぃ",yu:"ゅ",ye:"ぇ",yo:"ょ"},Jt={a:"ぁ",i:"ぃ",u:"ぅ",e:"ぇ",o:"ぉ"},Rt={sh:"sy",ch:"ty",cy:"ty",chy:"ty",shy:"sy",j:"zy",jy:"zy",shi:"si",chi:"ti",tsu:"tu",ji:"zi",fu:"hu"},Ft=Object.assign({tu:"っ",wa:"ゎ",ka:"ヵ",ke:"ヶ"},Jt,Dt),Kt={yi:"い",wu:"う",ye:"いぇ",wi:"うぃ",we:"うぇ",kwa:"くぁ",whu:"う",tha:"てゃ",thu:"てゅ",tho:"てょ",dha:"でゃ",dhu:"でゅ",dho:"でょ"},qt={wh:"う",kw:"く",qw:"く",q:"く",gw:"ぐ",sw:"す",ts:"つ",th:"て",tw:"と",dh:"で",dw:"ど",fw:"ふ",f:"ふ"};function Lt(){const t=zt(Pt),n=n=>Ut(t,n);function i(t){return Object.entries(t).reduce((t,[n,e])=>(t[n]=n?i(e):`っ${e}`,t),{})}return Object.entries(Bt).forEach(([t,i])=>{Object.entries(Dt).forEach(([e,s])=>{n(t+e)[""]=i+s})}),Object.entries(Tt).forEach(([t,i])=>{n(t)[""]=i}),Object.entries(qt).forEach(([t,i])=>{Object.entries(Jt).forEach(([e,s])=>{n(t+e)[""]=i+s})}),["n","n'","xn"].forEach(t=>{n(t)[""]="ん"}),t.c=JSON.parse(JSON.stringify(t.k)),Object.entries(Rt).forEach(([t,i])=>{const e=t.slice(0,t.length-1),s=t.charAt(t.length-1);n(e)[s]=JSON.parse(JSON.stringify(n(i)))}),Object.entries(Ft).forEach(([t,i])=>{const e=t=>t.charAt(t.length-1),s=t=>t.slice(0,t.length-1),r=n(`x${t}`);r[""]=i;var o;n(`l${s(t)}`)[e(t)]=r,(o=t,[...Object.entries(Rt),["c","k"]].reduce((t,[n,i])=>o.startsWith(i)?t.concat(o.replace(i,n)):t,[])).forEach(i=>{["l","x"].forEach(r=>{n(r+s(i))[e(i)]=n(r+t)})})}),Object.entries(Kt).forEach(([t,i])=>{n(t)[""]=i}),[...Object.keys(Bt),"c","y","w","j"].forEach(n=>{const e=t[n];e[n]=i(e)}),delete t.n.n,Object.freeze(JSON.parse(JSON.stringify(t)))}let Wt=null;const Ht=Mt({wi:"ゐ",we:"ゑ"});function Vt(t=""){return!ft(t)&&dt(t,65,90)}function Gt(t=""){return!ft(t)&&12540===t.charCodeAt(0)}function Qt(t=""){return!ft(t)&&(!!Gt(t)||dt(t,12353,12438))}function Zt(t=""){const n=[];return t.split("").forEach(t=>{if(Gt(t)||function(t=""){return!ft(t)&&12539===t.charCodeAt(0)}(t))n.push(t);else if(Qt(t)){const i=t.charCodeAt(0)+96,e=String.fromCharCode(i);n.push(e)}else n.push(t)}),n.join("")}const Xt=jt((t,n,i)=>{let e=(null==Wt&&(Wt=Lt()),Wt);return e=t?function(t){const n=JSON.parse(JSON.stringify(t));return n.n.n={"":"ん"},n.n[" "]={"":"ん"},n}(e):e,e=n?Ht(e):e,i&&(e=It(e,i)),e},xt);function Yt(t="",n={},i){let e;return i?e=n:(e=Et(n),i=Xt(e.IMEMode,e.useObsoleteKana,e.customKanaMapping)),function(t="",n={},i){const{IMEMode:e,useObsoleteKana:s,customKanaMapping:r}=n;i||(i=Xt(e,s,r));return Nt(t.toLowerCase(),i,!e)}(t,e,i).map(n=>{const[i,s,r]=n;if(null===r)return t.slice(i);const o=e.IMEMode===pt,c=e.IMEMode===wt||[...t.slice(i,s)].every(Vt);return o||!c?r:Zt(r)}).join("")}let tn=[];function nn(t){const n=Object.assign({},Et(t),{IMEMode:t.IMEMode||!0}),i=Xt(n.IMEMode,n.useObsoleteKana,n.customKanaMapping),e=[...Object.keys(i),...Object.keys(i).map(t=>t.toUpperCase())];return function({target:t}){undefined!==t.value&&"true"!==t.dataset.ignoreComposition&&function(t,n,i,e){const[s,r,o]=function(t="",n=0,i=[]){let e,s,r;0===n&&i.includes(t[0])?[e,s,r]=function(t,n){return["",...sn(t,t=>n.includes(t)||!Ot(t,/[0-9]/))]}(t,i):n>0?[e,s,r]=function(t="",n=0){const[i,e]=sn([...t.slice(0,n)].reverse(),t=>!Ot(t));return[e.reverse().join(""),i.split("").reverse().join(""),t.slice(n)]}(t,n):([e,s]=sn(t,t=>!i.includes(t)),[s,r]=sn(s,t=>!Ot(t)));return[e,s,r]}(t.value,t.selectionEnd,e),c=Yt(r,n,i);if(r!==c){const n=s.length+c.length,i=s+c+o;t.value=i,o.length?setTimeout(()=>t.setSelectionRange(n,n),1):t.setSelectionRange(n,n)}else t.value}(t,n,i,e)}}function en({type:t,target:n,data:i}){/Mac/.test(window.navigator&&window.navigator.platform)&&("compositionupdate"===t&&Ot(i)&&(n.dataset.ignoreComposition="true"),"compositionend"===t&&(n.dataset.ignoreComposition="false"))}function sn(t={},n=t=>!!t){const i=[],{length:e}=t;let s=0;for(;s<e&&n(t[s],s);)i.push(t[s]),s+=1;return[i.join(""),t.slice(s)]}const rn={input:({target:{value:t,selectionStart:n,selectionEnd:i}})=>console.log("input:",{value:t,selectionStart:n,selectionEnd:i}),compositionstart:()=>console.log("compositionstart"),compositionupdate:({target:{value:t,selectionStart:n,selectionEnd:i},data:e})=>console.log("compositionupdate",{data:e,value:t,selectionStart:n,selectionEnd:i}),compositionend:()=>console.log("compositionend")},on=["TEXTAREA","INPUT"];let cn=0;function un(t={},n={},i=!1){if(!on.includes(t.nodeName))throw new Error(`Element provided to Wanakana bind() was not a valid input or textarea element.\n Received: (${JSON.stringify(t)})`);if(t.hasAttribute("data-wanakana-id"))return;const e=nn(n),s=(cn+=1,`${Date.now()}${cn}`),r={};var o;[{name:"data-wanakana-id",value:s},{name:"lang",value:"ja"},{name:"autoCapitalize",value:"none"},{name:"autoCorrect",value:"off"},{name:"autoComplete",value:"off"},{name:"spellCheck",value:"false"}].forEach(n=>{r[n.name]=t.getAttribute(n.name),t.setAttribute(n.name,n.value)}),t.dataset.previousAttributes=JSON.stringify(r),t.addEventListener("input",e),t.addEventListener("compositionupdate",en),t.addEventListener("compositionend",en),function(t,n,i){tn=tn.concat({id:t,inputHandler:n,compositionHandler:i})}(s,e,en),!0===i&&(o=t,Object.entries(rn).forEach(([t,n])=>o.addEventListener(t,n)))}function an(t="",n){const i="regexp"===lt(n);return!ft(t)&&[...t].every(t=>{const e=function(t=""){return!ft(t)&&vt.some(([n,i])=>dt(t,n,i))}(t);return i?e||n.test(t):e})}function hn(t=""){return dt(t,12449,12540)}function ln(t=""){return!ft(t)&&[...t].every(Qt)}function fn(t=""){return!ft(t)&&[...t].every(hn)}function dn(t=""){return dt(t,19968,40879)||function(t=""){return!ft(t)&&12293===t.charCodeAt(0)}(t)}function pn(t=""){return!ft(t)&&[...t].every(dn)}let wn=null;const yn={あ:"a",い:"i",う:"u",え:"e",お:"o",か:"ka",き:"ki",く:"ku",け:"ke",こ:"ko",さ:"sa",し:"shi",す:"su",せ:"se",そ:"so",た:"ta",ち:"chi",つ:"tsu",て:"te",と:"to",な:"na",に:"ni",ぬ:"nu",ね:"ne",の:"no",は:"ha",ひ:"hi",ふ:"fu",へ:"he",ほ:"ho",ま:"ma",み:"mi",む:"mu",め:"me",も:"mo",ら:"ra",り:"ri",る:"ru",れ:"re",ろ:"ro",や:"ya",ゆ:"yu",よ:"yo",わ:"wa",ゐ:"wi",ゑ:"we",を:"wo",ん:"n",が:"ga",ぎ:"gi",ぐ:"gu",げ:"ge",ご:"go",ざ:"za",じ:"ji",ず:"zu",ぜ:"ze",ぞ:"zo",だ:"da",ぢ:"ji",づ:"zu",で:"de",ど:"do",ば:"ba",び:"bi",ぶ:"bu",べ:"be",ぼ:"bo",ぱ:"pa",ぴ:"pi",ぷ:"pu",ぺ:"pe",ぽ:"po",ゔぁ:"va",ゔぃ:"vi",ゔ:"vu",ゔぇ:"ve",ゔぉ:"vo"},gn={"。":".","、":",","：":":","・":"/","！":"!","？":"?","〜":"~",ー:"-","「":"‘","」":"’","『":"“","』":"”","［":"[","］":"]","（":"(","）":")","｛":"{","｝":"}","　":" "},bn=["あ","い","う","え","お","や","ゆ","よ"],mn={ゃ:"ya",ゅ:"yu",ょ:"yo"},vn={ぃ:"yi",ぇ:"ye"},kn={ぁ:"a",ぃ:"i",ぅ:"u",ぇ:"e",ぉ:"o"},On=["き","に","ひ","み","り","ぎ","び","ぴ","ゔ","く","ふ"],Sn={し:"sh",ち:"ch",じ:"j",ぢ:"j"},$n={っ:"",ゃ:"ya",ゅ:"yu",ょ:"yo",ぁ:"a",ぃ:"i",ぅ:"u",ぇ:"e",ぉ:"o"},_n={b:"b",c:"t",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",m:"m",p:"p",q:"q",r:"r",s:"s",t:"t",v:"v",w:"w",x:"x",z:"z"};function jn(){return null==wn&&(wn=function(){const t=zt(yn),n=n=>Ut(t,n),i=(t,i)=>{n(t)[""]=i};return Object.entries(gn).forEach(([t,i])=>{n(t)[""]=i}),[...Object.entries(mn),...Object.entries(kn)].forEach(([t,n])=>{i(t,n)}),On.forEach(t=>{const e=n(t)[""][0];Object.entries(mn).forEach(([n,s])=>{i(t+n,e+s)}),Object.entries(vn).forEach(([n,s])=>{i(t+n,e+s)})}),Object.entries(Sn).forEach(([t,n])=>{Object.entries(mn).forEach(([e,s])=>{i(t+e,n+s[1])}),i(`${t}ぃ`,`${n}yi`),i(`${t}ぇ`,`${n}e`)}),t["っ"]=An(t),Object.entries($n).forEach(([t,n])=>{i(t,n)}),bn.forEach(t=>{i(`ん${t}`,`n'${n(t)[""]}`)}),Object.freeze(JSON.parse(JSON.stringify(t)))}()),wn}function An(t){return Object.entries(t).reduce((t,[n,i])=>{if(n)t[n]=An(i);else{const e=i.charAt(0);t[n]=Object.keys(_n).includes(e)?_n[e]+i:i}return t},{})}function Cn(t="",n={}){const i=Et(n);if(i.passRomaji)return Zt(t);if(function(t="",n={passKanji:!0}){const i=[...t];let e=!1;return n.passKanji||(e=i.some(pn)),(i.some(ln)||i.some(fn))&&i.some(an)&&!e}(t)||an(t)||function(t=""){return!ft(t)&&kt.some(([n,i])=>dt(t,n,i))}(t)){return Zt(Yt(t.toLowerCase(),i))}return Zt(t)}jt((t,n)=>{let i=function(t){return t===yt?jn():{}}(t);return n&&(i=It(i,n)),i},xt);var xn=class{start_pos;length;name;cost;left_id;right_id;prev;surface_form;shortest_cost;type;constructor(t,n,i,e,s,r,o,c){this.name=t,this.cost=n,this.start_pos=i,this.length=e,this.left_id=r,this.right_id=o,this.prev=null,this.surface_form=c,this.shortest_cost="BOS"===s?0:Number.MAX_VALUE,this.type=s}},En=class{nodes_end_at;eos_pos;constructor(){this.nodes_end_at=[],this.nodes_end_at[0]=[new xn(-1,0,0,0,"BOS",0,0,"")],this.eos_pos=1}append(t){const n=t.start_pos+t.length-1;this.eos_pos<n&&(this.eos_pos=n);let i=this.nodes_end_at[n];null==i&&(i=[]),i.push(t),this.nodes_end_at[n]=i}appendEos(){const t=this.nodes_end_at.length;this.eos_pos++,this.nodes_end_at[t]=[new xn(-1,0,this.eos_pos,0,"EOS",0,0,"")]}},Nn=class t{length;str;index_mapping;constructor(n){this.str=n,this.index_mapping=[];for(let i=0;i<n.length;i++){const e=n.charAt(i);this.index_mapping.push(i),t.isSurrogatePair(e)&&i++}this.length=this.index_mapping.length}slice(t){if(this.index_mapping.length<=t)return"";const n=this.index_mapping[t];return this.str.slice(n)}charAt(t){if(this.str.length<=t)return"";const n=this.index_mapping[t],i=this.index_mapping[t+1];return null==i?this.str.slice(n):this.str.slice(n,i)}charCodeAt(t){if(this.index_mapping.length<=t)return NaN;const n=this.index_mapping[t],i=this.str.charCodeAt(n);let e;return i>=55296&&i<=56319&&n<this.str.length&&(e=this.str.charCodeAt(n+1),e>=56320&&e<=57343)?1024*(i-55296)+e-56320+65536:i}toString(){return this.str}static isSurrogatePair(t){const n=t.charCodeAt(0);return n>=55296&&n<=56319}},zn=class{trie;token_info_dictionary;unknown_dictionary;constructor(t){this.trie=t.trie,this.token_info_dictionary=t.token_info_dictionary,this.unknown_dictionary=t.unknown_dictionary}build(t){const n=new En,i=new Nn(t);let e,s,r,o,c;for(let t=0;t<i.length;t++){const u=i.slice(t),a=this.trie.commonPrefixSearch(u);for(let i=0;i<a.length;i++){s=a[i].v,e=a[i].k;const u=this.token_info_dictionary.target_map[s];for(let i=0;i<u.length;i++){const s=parseInt(u[i]);r=this.token_info_dictionary.dictionary.getShort(s),o=this.token_info_dictionary.dictionary.getShort(s+2),c=this.token_info_dictionary.dictionary.getShort(s+4),n.append(new xn(s,c,t+1,e.length,"KNOWN",r,o,e))}}const h=new Nn(u),l=new Nn(h.charAt(0)),f=this.unknown_dictionary.lookup(l.toString());if(!f)throw new Error("Unknown character: "+l);if(null==a||0===a.length||1===f.is_always_invoke){if(e=l,1===f.is_grouping&&1<h.length)for(let t=1;t<h.length;t++){const n=h.charAt(t),i=this.unknown_dictionary.lookup(n);if(f.class_name!==i.class_name)break;e+=n}const i=this.unknown_dictionary.target_map[f.class_id];for(let s=0;s<i.length;s++){const u=parseInt(i[s]);r=this.unknown_dictionary.dictionary.getShort(u),o=this.unknown_dictionary.dictionary.getShort(u+2),c=this.unknown_dictionary.dictionary.getShort(u+4),n.append(new xn(u,c,t+1,e.length,"UNKNOWN",r,o,e.toString()))}}}return n.appendEos(),n}},Un=class{connection_costs;constructor(t){this.connection_costs=t}search(t){return t=this.forward(t),this.backward(t)}forward(t){let n,i,e;for(n=1;n<=t.eos_pos;n++){const s=t.nodes_end_at[n];if(null!=s)for(i=0;i<s.length;i++){const n=s[i];let r=Number.MAX_VALUE,o=null;const c=t.nodes_end_at[n.start_pos-1];if(null!=c){for(e=0;e<c.length;e++){const t=c[e];let i;null==n.left_id||null==t.right_id?(console.log("Left or right is null"),i=0):i=this.connection_costs.get(t.right_id,n.left_id);const s=t.shortest_cost+i+n.cost;s<r&&(o=t,r=s)}n.prev=o,n.shortest_cost=r}}}return t}backward(t){const n=[];let i=t.nodes_end_at[t.nodes_end_at.length-1][0].prev;if(null==i)return[];for(;"BOS"!==i.type;){if(n.push(i),null==i.prev)return[];i=i.prev}return n.reverse()}},Mn=class{formatEntry(t,n,i,e){const s={};return s.word_id=t,s.word_type=i,s.word_position=n,s.surface_form=e[0],s.pos=e[1],s.pos_detail_1=e[2],s.pos_detail_2=e[3],s.pos_detail_3=e[4],s.conjugated_type=e[5],s.conjugated_form=e[6],s.basic_form=e[7],s.reading=e[8],s.pronunciation=e[9],s}formatUnknownEntry(t,n,i,e,s){const r={};return r.word_id=t,r.word_type=i,r.word_position=n,r.surface_form=s,r.pos=e[1],r.pos_detail_1=e[2],r.pos_detail_2=e[3],r.pos_detail_3=e[4],r.conjugated_type=e[5],r.conjugated_form=e[6],r.basic_form=e[7],r}},In=/、|。/,Pn=class t{token_info_dictionary;unknown_dictionary;viterbi_builder;viterbi_searcher;formatter;constructor(t){this.token_info_dictionary=t.token_info_dictionary,this.unknown_dictionary=t.unknown_dictionary,this.viterbi_builder=new zn(t),this.viterbi_searcher=new Un(t.connection_costs),this.formatter=new Mn}tokenize(n){const i=t.splitByPunctuation(n),e=[];for(let t=0;t<i.length;t++){const n=i[t];this.tokenizeForSentence(n,e)}return e}tokenizeForSentence(t,n){null==n&&(n=[]);const i=this.getLattice(t),e=this.viterbi_searcher.search(i);let s=0;n.length>0&&(s=n[n.length-1].word_position);for(let t=0;t<e.length;t++){const i=e[t];let r,o,c;"KNOWN"===i.type?(c=this.token_info_dictionary.getFeatures(i.name),o=null==c?[]:c.split(","),r=this.formatter.formatEntry(i.name,s+i.start_pos,i.type,o)):"UNKNOWN"===i.type?(c=this.unknown_dictionary.getFeatures(i.name),o=null==c?[]:c.split(","),r=this.formatter.formatUnknownEntry(i.name,s+i.start_pos,i.type,o,i.surface_form)):r=this.formatter.formatEntry(i.name,s+i.start_pos,i.type,[]),n.push(r)}return n}getLattice(t){return this.viterbi_builder.build(t)}static splitByPunctuation(t){const n=[];let i=t;for(;""!==i;){const t=i.search(In);if(t<0){n.push(i);break}n.push(i.substring(0,t+1)),i=i.substring(t+1)}return n}},Tn=-1,Bn=!0,Dn=!0,Jn=function(t){null==t&&(t=1024);let n=function(t,n,i){for(let e=n;e<i;e++)t[e]=1-e;if(0<o.array[o.array.length-1]){let i=o.array.length-2;for(;0<o.array[i];)i--;t[n]=-i}},i=function(t,n,i){for(let e=n;e<i;e++)t[e]=-e-1},e=function(t){let e=2*t,s=Kn(r.signed,r.bytes,e);n(s,r.array.length,e),s.set(r.array),r.array=null,r.array=s;let c=Kn(o.signed,o.bytes,e);i(c,o.array.length,e),c.set(o.array),o.array=null,o.array=c},s=1;var r={signed:Bn,bytes:4,array:Kn(Bn,4,t)},o={signed:Dn,bytes:4,array:Kn(Dn,4,t)};return r.array[0]=1,o.array[0]=0,n(r.array,1,r.array.length),i(o.array,1,o.array.length),{getBaseBuffer:function(){return r.array},getCheckBuffer:function(){return o.array},loadBaseBuffer:function(t){return r.array=t,this},loadCheckBuffer:function(t){return o.array=t,this},size:function(){return Math.max(r.array.length,o.array.length)},getBase:function(t){return r.array.length-1<t?1-t:r.array[t]},getCheck:function(t){return o.array.length-1<t?-t-1:o.array[t]},setBase:function(t,n){r.array.length-1<t&&e(t),r.array[t]=n},setCheck:function(t,n){o.array.length-1<t&&e(t),o.array[t]=n},setFirstUnusedNode:function(t){s=t},getFirstUnusedNode:function(){return s},shrink:function(){let t=this.size()-1;for(;!(0<=o.array[t]);)t--;r.array=r.array.subarray(0,t+2),o.array=o.array.subarray(0,t+2)},calc:function(){let t=0,n=o.array.length;for(let i=0;i<n;i++)o.array[i]<0&&t++;return{all:n,unused:t,efficiency:(n-t)/n}},dump:function(){let t,n="",i="";for(t=0;t<r.array.length;t++)n=n+" "+this.getBase(t);for(t=0;t<o.array.length;t++)i=i+" "+this.getCheck(t);return console.log("base:"+n),console.log("chck:"+i),"base:"+n+" chck:"+i}}};function Rn(t){this.bc=Jn(t),this.keys=[]}function Fn(t){this.bc=t,this.bc.shrink()}Rn.prototype.append=function(t,n){return this.keys.push({k:t,v:n}),this},Rn.prototype.build=function(t,n){if(null==t&&(t=this.keys),null==t)return new Fn(this.bc);null==n&&(n=!1);let i=t.map(function(t){return{k:Ln(t.k+"\0"),v:t.v}});return this.keys=n?i:i.sort(function(t,n){const i=t.k,e=n.k,s=Math.min(i.length,e.length);for(let t=0;t<s;t++)if(i[t]!==e[t])return i[t]-e[t];return i.length-e.length}),i=null,this._build(0,0,0,this.keys.length),new Fn(this.bc)},Rn.prototype._build=function(t,n,i,e){const s=this.getChildrenInfo(n,i,e),r=this.findAllocatableBase(s);this.setBC(t,s,r);for(let t=0;t<s.length;t+=3){const i=s[t];if(0===i)continue;const e=s[t+1],o=s[t+2],c=r+i;this._build(c,n+1,e,o)}},Rn.prototype.getChildrenInfo=function(t,n,i){let e=this.keys[n].k[t],s=0,r=new Int32Array(3*i);r[s++]=e,r[s++]=n;let o=n,c=n;for(;o<n+i;o++){const n=this.keys[o].k[t];e!==n&&(r[s++]=o-c,r[s++]=n,r[s++]=o,e=n,c=o)}return r[s++]=o-c,r=r.subarray(0,s),r},Rn.prototype.setBC=function(t,n,i){const e=this.bc;let s;for(e.setBase(t,i),s=0;s<n.length;s+=3){const r=n[s],o=i+r,c=-e.getBase(o),u=-e.getCheck(o);o!==e.getFirstUnusedNode()?e.setCheck(c,-u):e.setFirstUnusedNode(u),e.setBase(u,-c);const a=t;if(e.setCheck(o,a),0===r){const t=n[s+1];let i=this.keys[t].v;null==i&&(i=0);const r=-i-1;e.setBase(o,r)}}},Rn.prototype.findAllocatableBase=function(t){const n=this.bc;let i,e=n.getFirstUnusedNode();for(;;){if(i=e-t[0],i<0){e=-n.getCheck(e);continue}let s=!0;for(let r=0;r<t.length;r+=3){const o=i+t[r];if(!this.isUnusedNode(o)){e=-n.getCheck(e),s=!1;break}}if(s)return i}},Rn.prototype.isUnusedNode=function(t){const n=this.bc.getCheck(t);return 0!==t&&n<0},Fn.prototype.contain=function(t){const n=this.bc,i=Ln(t+="\0");let e=0,s=Tn;for(let t=0;t<i.length;t++){const r=i[t];if(s=this.traverse(e,r),s===Tn)return!1;if(n.getBase(s)<=0)return!0;e=s}return!1},Fn.prototype.lookup=function(t){const n=Ln(t+="\0");let i=0,e=Tn;for(let t=0;t<n.length;t++){const s=n[t];if(e=this.traverse(i,s),e===Tn)return Tn;i=e}const s=this.bc.getBase(e);return s<=0?-s-1:Tn},Fn.prototype.commonPrefixSearch=function(t){const n=Ln(t);let i=0,e=Tn;const s=[];for(let t=0;t<n.length;t++){const r=n[t];if(e=this.traverse(i,r),e!==Tn){i=e;const r=this.traverse(e,0);if(r!==Tn){const i=this.bc.getBase(r),e={};i<=0&&(e.v=-i-1),e.k=Wn(qn(n,0,t+1)),s.push(e)}continue}break}return s},Fn.prototype.traverse=function(t,n){const i=this.bc.getBase(t)+n;return this.bc.getCheck(i)===t?i:Tn},Fn.prototype.size=function(){return this.bc.size()},Fn.prototype.calc=function(){return this.bc.calc()},Fn.prototype.dump=function(){return this.bc.dump()};var Kn=function(t,n,i){switch(n){case 1:return new Int8Array(i);case 2:return new Int16Array(i);case 4:return new Int32Array(i);default:throw new RangeError("Invalid newArray parameter element_bytes:"+n)}},qn=function(t,n,i){const e=new ArrayBuffer(i),s=new Uint8Array(e,0,i),r=t.subarray(n,i);return s.set(r),s},Ln=function(t){const n=new Uint8Array(new ArrayBuffer(4*t.length));let i=0,e=0;for(;i<t.length;){var s;const r=t.charCodeAt(i++);if(r>=55296&&r<=56319){const n=r,e=t.charCodeAt(i++);if(!(e>=56320&&e<=57343))return null;s=1024*(n-55296)+65536+(e-56320)}else s=r;s<128?n[e++]=s:s<2048?(n[e++]=s>>>6|192,n[e++]=63&s|128):s<65536?(n[e++]=s>>>12|224,n[e++]=s>>6&63|128,n[e++]=63&s|128):s<1<<21&&(n[e++]=s>>>18|240,n[e++]=s>>12&63|128,n[e++]=s>>6&63|128,n[e++]=63&s|128)}return n.subarray(0,e)},Wn=function(t){let n,i,e,s,r,o,c,u="",a=0;for(;a<t.length;)i=t[a++],i<128?n=i:i>>5==6?(e=t[a++],n=(31&i)<<6|63&e):i>>4==14?(e=t[a++],s=t[a++],n=(15&i)<<12|(63&e)<<6|63&s):(e=t[a++],s=t[a++],r=t[a++],n=(7&i)<<18|(63&e)<<12|(63&s)<<6|63&r),n<65536?u+=String.fromCharCode(n):(n-=65536,o=55296|n>>10,c=56320|1023&n,u+=String.fromCharCode(o,c));return u};var Hn=class{buffer;position;constructor(t){let n;if(null==t)n=1048576;else{if("number"!=typeof t){if(t instanceof Uint8Array)return this.buffer=t,void(this.position=0);throw typeof t+" is invalid parameter type for ByteBuffer constructor"}n=t}this.buffer=new Uint8Array(n),this.position=0}size(){return this.buffer.length}reallocate(){const t=new Uint8Array(2*this.buffer.length);t.set(this.buffer),this.buffer=t}shrink(){return this.buffer=this.buffer.subarray(0,this.position),this.buffer}put(t){this.buffer.length<this.position+1&&this.reallocate(),this.buffer[this.position++]=t}get(t){return null==t&&(t=this.position,this.position+=1),this.buffer.length<t+1?0:this.buffer[t]}putShort(t){if(65535<t)throw t+" is over short value";const n=255&t,i=(65280&t)>>8;this.put(n),this.put(i)}getShort(t){if(null==t&&(t=this.position,this.position+=2),this.buffer.length<t+2)return 0;const n=this.buffer[t];let i=(this.buffer[t+1]<<8)+n;return 32768&i&&(i=-(i-1^65535)),i}putInt(t){if(4294967295<t)throw t+" is over integer value";const n=255&t,i=(65280&t)>>8,e=(16711680&t)>>16,s=(4278190080&t)>>24;this.put(n),this.put(i),this.put(e),this.put(s)}getInt(t){if(null==t&&(t=this.position,this.position+=4),this.buffer.length<t+4)return 0;const n=this.buffer[t],i=this.buffer[t+1],e=this.buffer[t+2];return(this.buffer[t+3]<<24)+(e<<16)+(i<<8)+n}readInt(){const t=this.position;return this.position+=4,this.getInt(t)}putString(t){const n=function(t){const n=new Uint8Array(4*t.length);let i=0,e=0;for(;i<t.length;){let s;const r=t.charCodeAt(i++);if(r>=55296&&r<=56319){const n=r,e=t.charCodeAt(i++);if(!(e>=56320&&e<=57343))return null;s=1024*(n-55296)+65536+(e-56320)}else s=r;s<128?n[e++]=s:s<2048?(n[e++]=s>>>6|192,n[e++]=63&s|128):s<65536?(n[e++]=s>>>12|224,n[e++]=s>>6&63|128,n[e++]=63&s|128):s<1<<21&&(n[e++]=s>>>18|240,n[e++]=s>>12&63|128,n[e++]=s>>6&63|128,n[e++]=63&s|128)}return n.subarray(0,e)}(t);for(let t=0;t<n.length;t++)this.put(n[t]);this.put(0)}getString(t){const n=[];let i;for(null==t&&(t=this.position);!(this.buffer.length<t+1)&&(i=this.get(t++),0!==i);)n.push(i);return this.position=t,function(t){let n,i,e,s,r,o,c,u="",a=0;for(;a<t.length;)i=t[a++],i<128?n=i:i>>5==6?(e=t[a++],n=(31&i)<<6|63&e):i>>4==14?(e=t[a++],s=t[a++],n=(15&i)<<12|(63&e)<<6|63&s):(e=t[a++],s=t[a++],r=t[a++],n=(7&i)<<18|(63&e)<<12|(63&s)<<6|63&r),n<65536?u+=String.fromCharCode(n):(n-=65536,o=55296|n>>10,c=56320|1023&n,u+=String.fromCharCode(o,c));return u}(n)}},Vn=class{dictionary;target_map;pos_buffer;constructor(){this.dictionary=new Hn(10485760),this.target_map={},this.pos_buffer=new Hn(10485760)}buildDictionary(t){const n={};for(let i=0;i<t.length;i++){const e=t[i];if(e.length<4)continue;const s=e[0],r=e[1],o=e[2],c=e[3],u=e.slice(4).join(",");isFinite(r)&&isFinite(o)&&isFinite(c)||console.log(e);n[this.put(r,o,c,s,u)]=s}return this.dictionary.shrink(),this.pos_buffer.shrink(),n}put(t,n,i,e,s){const r=this.dictionary.position,o=this.pos_buffer.position;return this.dictionary.putShort(t),this.dictionary.putShort(n),this.dictionary.putShort(i),this.dictionary.putInt(o),this.pos_buffer.putString(e+","+s),r}addMapping(t,n){let i=this.target_map[t];null==i&&(i=[]),i.push(n),this.target_map[t]=i}targetMapToBuffer(){const t=new Hn,n=Object.keys(this.target_map).length;t.putInt(n);for(const n in this.target_map){const i=this.target_map[n],e=i.length;t.putInt(parseInt(n)),t.putInt(e);for(let n=0;n<i.length;n++)t.putInt(i[n])}return t.shrink()}loadDictionary(t){return this.dictionary=new Hn(t),this}loadPosVector(t){return this.pos_buffer=new Hn(t),this}loadTargetMap(t){const n=new Hn(t);for(n.position=0,this.target_map={},n.readInt();!(n.buffer.length<n.position+1);){const t=n.readInt(),i=n.readInt();for(let e=0;e<i;e++){const i=n.readInt();this.addMapping(t,i)}}return this}getFeatures(t){const n=parseInt(t);if(isNaN(n))return"";const i=this.dictionary.getInt(n+6);return this.pos_buffer.getString(i)}},Gn=class{forward_dimension;backward_dimension;buffer;constructor(t,n){this.forward_dimension=t,this.backward_dimension=n,this.buffer=new Int16Array(t*n+2),this.buffer[0]=t,this.buffer[1]=n}put(t,n,i){const e=t*this.backward_dimension+n+2;if(this.buffer.length<e+1)throw"ConnectionCosts buffer overflow";this.buffer[e]=i}get(t,n){const i=t*this.backward_dimension+n+2;if(this.buffer.length<i+1)throw"ConnectionCosts buffer overflow";return this.buffer[i]}loadConnectionCosts(t){this.forward_dimension=t[0],this.backward_dimension=t[1],this.buffer=t}},Qn=class{class_id;class_name;is_always_invoke;is_grouping;max_length;constructor(t,n,i,e,s){this.class_id=t,this.class_name=n,this.is_always_invoke=i,this.is_grouping=e,this.max_length=s}},Zn=class t{map;lookup_table;constructor(){this.map=[],this.lookup_table={}}init(t){if(null!=t)for(let n=0;n<t.length;n++){const i=t[n];this.map[n]=i,this.lookup_table[i.class_name]=n}}getCharacterClass(t){return this.map[t]}lookup(t){const n=this.lookup_table[t];return n??null}toBuffer(){const t=new Hn;for(let n=0;n<this.map.length;n++){const i=this.map[n];t.put(i.is_always_invoke),t.put(i.is_grouping),t.putInt(i.max_length),t.putString(i.class_name)}return t.shrink(),t.buffer}static load(n){const i=new t,e=[],s=new Hn(n);for(;s.position+1<s.size();){const t=e.length,n=s.get(),i=s.get(),r=s.getInt(),o=s.getString();e.push(new Qn(t,o,n,i,r))}return i.init(e),i}},Xn="DEFAULT",Yn=class t{character_category_map;compatible_category_map;invoke_definition_map;constructor(){this.character_category_map=new Uint8Array(65536),this.compatible_category_map=new Uint32Array(65536),this.invoke_definition_map=null}initCategoryMappings(t){let n;if(null!=t)for(let i=0;i<t.length;i++){const e=t[i],s=e.end||e.start;for(n=e.start;n<=s;n++){this.character_category_map[n]=this.invoke_definition_map.lookup(e.default);for(let t=0;t<e.compatible.length;t++){let i=this.compatible_category_map[n];const s=e.compatible[t];if(null==s)continue;const r=this.invoke_definition_map.lookup(s);if(null==r)continue;i|=1<<r,this.compatible_category_map[n]=i}}}const i=this.invoke_definition_map.lookup(Xn);if(null!=i)for(n=0;n<this.character_category_map.length;n++)0===this.character_category_map[n]&&(this.character_category_map[n]=1<<i)}lookupCompatibleCategory(t){const n=[],i=t.charCodeAt(0);let e;if(i<this.compatible_category_map.length&&(e=this.compatible_category_map[i]),null==e||0===e)return n;for(let t=0;t<32;t++)if(e<<31-t>>>31==1){const i=this.invoke_definition_map.getCharacterClass(t);if(null==i)continue;n.push(i)}return n}lookup(t){let n;const i=t.charCodeAt(0);return Nn.isSurrogatePair(t)?n=this.invoke_definition_map.lookup(Xn):i<this.character_category_map.length&&(n=this.character_category_map[i]),null==n&&(n=this.invoke_definition_map.lookup(Xn)),this.invoke_definition_map.getCharacterClass(n)}static load(n,i,e){const s=new t;return s.character_category_map=n,s.compatible_category_map=i,s.invoke_definition_map=Zn.load(e),s}static parseCharCategory(t,n){const i=n[1],e=parseInt(n[2]),s=parseInt(n[3]),r=parseInt(n[4]);if(!isFinite(e)||0!==e&&1!==e)return console.log("char.def parse error. INVOKE is 0 or 1 in:"+e),null;if(!isFinite(s)||0!==s&&1!==s)return console.log("char.def parse error. GROUP is 0 or 1 in:"+s),null;if(!isFinite(r)||r<0)return console.log("char.def parse error. LENGTH is 1 to n:"+r),null;return new Qn(t,i,1===e,1===s,r)}static parseCategoryMapping(t){const n=parseInt(t[1]),i=t[2],e=3<t.length?t.slice(3):[];return(!isFinite(n)||n<0||n>65535)&&console.log("char.def parse error. CODE is invalid:"+n),{start:n,default:i,compatible:e}}static parseRangeCategoryMapping(t){const n=parseInt(t[1]),i=parseInt(t[2]),e=t[3],s=4<t.length?t.slice(4):[];return(!isFinite(n)||n<0||n>65535)&&console.log("char.def parse error. CODE is invalid:"+n),(!isFinite(i)||i<0||i>65535)&&console.log("char.def parse error. CODE is invalid:"+i),{start:n,end:i,default:e,compatible:s}}},ti=class extends Vn{character_definition;constructor(){super(),this.dictionary=new Hn(10485760),this.target_map={},this.pos_buffer=new Hn(10485760),this.character_definition=null}characterDefinition(t){return this.character_definition=t,this}lookup(t){return this.character_definition?.lookup(t)}lookupCompatibleCategory(t){return this.character_definition?.lookupCompatibleCategory(t)}loadUnknownDictionaries(t,n,i,e,s,r){this.loadDictionary(t),this.loadPosVector(n),this.loadTargetMap(i),this.character_definition=Yn.load(e,s,r)}},ni=class{trie;token_info_dictionary;connection_costs;unknown_dictionary;constructor(t,n,i,e){var s;this.trie=null!=t?t:(s=0,new Rn(s)).build([{k:"",v:1}]),this.token_info_dictionary=null!=n?n:new Vn,this.connection_costs=null!=i?i:new Gn(0,0),this.unknown_dictionary=null!=e?e:new ti}loadTrie(t,n){return this.trie=function(t,n){let i=Jn(0);return i.loadBaseBuffer(t),i.loadCheckBuffer(n),new Fn(i)}(t,n),this}loadTokenInfoDictionaries(t,n,i){return this.token_info_dictionary.loadDictionary(t),this.token_info_dictionary.loadPosVector(n),this.token_info_dictionary.loadTargetMap(i),this}loadConnectionCosts(t){return this.connection_costs.loadConnectionCosts(t),this}loadUnknownDictionaries(t,n,i,e,s,r){return this.unknown_dictionary.loadUnknownDictionaries(t,n,i,e,s,r),this}};var ii=class{constructor(t){this.options=t}async build(){const t=await async function(t){const n=new ni;return await Promise.all([async function(){const i=await Promise.all(["base.dat.gz","check.dat.gz"].map(n=>t.loadArrayBuffer(n))),e=new Int32Array(i[0]),s=new Int32Array(i[1]);n.loadTrie(e,s)}(),async function(){const i=await Promise.all(["tid.dat.gz","tid_pos.dat.gz","tid_map.dat.gz"].map(n=>t.loadArrayBuffer(n))),e=new Uint8Array(i[0]),s=new Uint8Array(i[1]),r=new Uint8Array(i[2]);n.loadTokenInfoDictionaries(e,s,r)}(),async function(){const i=await t.loadArrayBuffer("cc.dat.gz"),e=new Int16Array(i);n.loadConnectionCosts(e)}(),async function(){const i=await Promise.all(["unk.dat.gz","unk_pos.dat.gz","unk_map.dat.gz","unk_char.dat.gz","unk_compat.dat.gz","unk_invoke.dat.gz"].map(n=>t.loadArrayBuffer(n))),e=new Uint8Array(i[0]),s=new Uint8Array(i[1]),r=new Uint8Array(i[2]),o=new Uint8Array(i[3]),c=new Uint32Array(i[4]),u=new Uint8Array(i[5]);n.loadUnknownDictionaries(e,s,r,o,c,u)}()]),n}(this.options.loader);return new Pn(t)}};
/**
 * @license
 * Copyright 2025 Jomo Fisher
 * SPDX-License-Identifier: BSD-3-Clause
 */
const ei={async loadArrayBuffer(t){t=t.replace(/\.gz$/,"");const n=await fetch("https://cdn.jsdelivr.net/npm/@aiktb/kuromoji@1.0.2/dict/"+t);if(!n.ok)throw new Error(`Failed to fetch ${t}: ${n.status}`);return n.arrayBuffer()}};let si=null;let ri=async t=>{try{return(await(si||(console.log("Initializing kuromoji tokenizer..."),si=new ii({loader:ei}).build()),si)).tokenize(t)}catch(t){throw console.error("Tokenization failed:",t),t}};const oi=t=>ri(t);
/**
 * @license
 * Copyright 2025 Jomo Fisher
 * SPDX-License-Identifier: BSD-3-Clause
 */function ci(t,n){return async function(i){const e=[];for(const s of i)s.surface_form===t?e.push(n):e.push(s.surface_form);return Promise.resolve([await oi(e.join(" "))])}}function ui(t,n){return async function(i){let e=!1;const s=[];for(const r of i)r.surface_form===t?(s.push(n),e=!0):s.push(r.surface_form);return e?Promise.resolve([await oi(s.join(""))]):[]}}const ai=(hi=t=>t.length>2&&"私"===t[0].surface_form&&"は"===t[1].surface_form,li=t=>{const n=t.split(" ").filter(t=>t.length>0);return n.length>=2&&"私"===n[0]&&"は"===n[1]?[n.slice(2).join(" ")]:[t]},async t=>{if(!hi(t))return[];const n=t.map(t=>t.surface_form).join(" "),i=li(n),e=[];for(const t of i){const n=await oi(t);e.push(n)}return e});var hi,li;function fi(t,n){return async i=>{const e=i.findIndex(n=>n.surface_form===t);if(-1===e)return Promise.resolve([]);const s=structuredClone(i);return s[e].reading=n,Promise.resolve([s])}}const di=[ci("私","僕"),ci("僕","俺"),ci("あなた","君"),ci("君","あなた"),ci("私","あたし"),async function(t){const n=t.findIndex(t=>"です"===t.surface_form);if(n!==t.length-1&&(n!==t.length-2||"記号"!==t[t.length-1].pos&&"名詞"!==t[t.length-1].pos))return Promise.resolve([]);if(n>0){if("名詞"!==t[n-1].pos)return Promise.resolve([])}const i=t.map((t,i)=>i===n?"だ":t.surface_form).join(" "),e=await oi(i);return Promise.resolve([e])},ai,fi("日本","ニッポン"),fi("日本","ニホン"),async t=>{const n=t.findIndex(t=>"だ"===t.surface_form);if(-1===n)return[];if(n!==t.length-1&&(n!==t.length-2||"記号"!==t[t.length-1].pos&&"名詞"!==t[t.length-1].pos))return[];if(n>0&&"名詞"!==t[n-1].pos)return[];const i=t.map((t,i)=>i===n?"です":t.surface_form).join(" ");return[await oi(i)]},async t=>{const n=t.findIndex(t=>"では"===t.surface_form);if(-1===n)return[];if(n+1<t.length&&"あり"===t[n+1].surface_form&&n+2<t.length&&"ない"===t[n+2].surface_form)return[];const i=t.map((t,i)=>i===n?"じゃ":t.surface_form).join(" ");return[await oi(i)]},async t=>{const n=t.findIndex(t=>"じゃ"===t.surface_form);if(-1===n)return[];const i=t.map((t,i)=>i===n?"では":t.surface_form).join(" ");return[await oi(i)]},async t=>{let n=t.length-1;for(;n>=0&&"記号"===t[n].pos;)n--;if(n>=1){const i=t[n],e=t[n-1];if("動詞"===i.pos&&"いる"===i.surface_form&&e.surface_form.match(/^(て|で)$/)){const i=t.map((t,i)=>i===n?"る":t.surface_form).join(" ");return[await oi(i)]}}if(n<0)return[];const i=t[n];if(!i||"動詞"!==i.pos)return[];if(!i.surface_form.includes("ている")&&!i.surface_form.includes("でいる"))return[];const e=i.surface_form.replace(/ている/g,"てる").replace(/でいる/g,"でる"),s=t.map((t,i)=>i===n?e:t.surface_form).join(" ");return[await oi(s)]},async t=>{const n=t.findIndex(t=>"という"===t.surface_form);if(-1!==n){const i=t.map((t,i)=>i===n?"っていう":t.surface_form).join(" ");return[await oi(i)]}for(let n=0;n<t.length-1;n++){const i=t[n],e=t[n+1];if("と"===i.surface_form&&"助詞"===i.pos&&"動詞"===e.pos&&("言う"===e.basic_form||"言う"===e.surface_form)){const i=t.map((t,i)=>i===n?"って":t.surface_form).join(" ");return[await oi(i)]}}return[]},async t=>{const n=t.findIndex(t=>"っていう"===t.surface_form);if(-1!==n){const i=t.map((t,i)=>i===n?"という":t.surface_form).join(" ");return[await oi(i)]}for(let n=0;n<t.length-1;n++){const i=t[n],e=t[n+1];if("って"===i.surface_form&&"動詞"===e.pos&&("言う"===e.basic_form||"言う"===e.surface_form)){const i=t.map((t,i)=>i===n?"と":t.surface_form).join(" ");return[await oi(i)]}}return[]},async t=>{for(let n=0;n<t.length-1;n++){const i=t[n],e=t[n+1];if("と"===i.surface_form&&"助詞"===i.pos&&"動詞"===e.pos&&("思う"===e.basic_form||"思う"===e.surface_form)){const i=t.map((t,i)=>i===n?"って":t.surface_form).join(" ");return[await oi(i)]}}return[]},async t=>{for(let n=0;n<t.length-1;n++){const i=t[n],e=t[n+1];if("って"===i.surface_form&&"動詞"===e.pos&&("思う"===e.basic_form||"思う"===e.surface_form)){const i=t.map((t,i)=>i===n?"と":t.surface_form).join(" ");return[await oi(i)]}}return[]},ui("だった","でした"),ui("でした","だった"),async t=>{let n=t.length-1;for(;n>=0&&"記号"===t[n].pos;)n--;if(n<0)return[];const i=t[n];if(!i||"動詞"!==i.pos)return[];if(!i.surface_form.includes("てる")&&!i.surface_form.includes("でる"))return[];const e=i.surface_form.replace(/てる/g,"ている").replace(/でる/g,"でいる"),s=t.map((t,i)=>i===n?e:t.surface_form).join(" ");return[await oi(s)]},async t=>{let n=t.length-1;for(;n>=0&&"記号"===t[n].pos;)n--;if(n<0)return[];const i=t[n];if(!i||"動詞"!==i.pos||!i.surface_form.endsWith("ます"))return[];const e=i.surface_form.replace(/ます$/,""),s=t.map((t,i)=>i===n?e:t.surface_form).join(" ");return[await oi(s)]},async t=>{let n=t.length-1;for(;n>=0&&"記号"===t[n].pos;)n--;if(n<0)return[];const i=t[n];if(!i||"動詞"!==i.pos)return[];let e=null;if(/る$/.test(i.surface_form)?e=i.surface_form.replace(/る$/,"ます"):/う$/.test(i.surface_form)&&(e=i.surface_form.replace(/う$/,"います")),!e)return[];const s=t.map((t,i)=>i===n?e:t.surface_form).join(" ");return[await oi(s)]},async t=>{if(t.length<2)return[];let n=t.length-1;for(;n>=0&&"記号"===t[n].pos;)n--;if(n<1)return[];const i=t[n];if("ませ"===t[n-1].surface_form&&"ん"===i.surface_form){const i=n>=2?t[n-2]:null;if(i&&"あり"===i.surface_form)return[];const e=t.slice(0,n-1).map(t=>t.surface_form),s=t.slice(n+1).map(t=>t.surface_form),r=e.concat(["ない"],s).join(" ");return[await oi(r)]}return[]},async t=>{if(t.length<2)return[];let n=t.length-1;for(;n>=0&&"記号"===t[n].pos;)n--;if(n<1)return[];const i=t[n],e=t[n-1];if("ない"!==i.surface_form)return[];if("動詞"!==e.pos)return[];const s=t.slice(0,n).map(t=>t.surface_form),r=t.slice(n+1).map(t=>t.surface_form),o=s.concat(["ませ","ん"],r).join(" ");return[await oi(o)]}];function pi(t){return JSON.stringify(t.map(t=>`${t.surface_form}(${t.reading})`))}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
function wi(t,n,i,e){if(e===n.length)return[];for(let s=i;s<t.length;s++){const i=t[s].reading;if(n.startsWith(i,e)){const r=wi(t,n,s+1,e+i.length);if(r)return[s,...r]}}return null}function yi(t,n){if(t.length>0&&Array.isArray(t[0])){const i=t,e=gi(i);return i.map(t=>e.includes(t)?yi(t,n):{matched:null})}const i=t,e=wi(i,n,0,0);if(!e)return{matched:null};const s=[];for(const t of e)i[t].marked||(i[t].marked=!0,s.push(t));return{matched:s}}function gi(t){if(0===t.length)return[];const n=t.map(t=>t.reduce((t,n)=>t+(n.marked?1:0),0)),i=Math.max(...n);return t.filter((t,e)=>n[e]===i)}function bi(t){if(0===t.length)throw new Error("No groups provided");const n=gi(t);if(1===n.length)return n[0];let i=n[0],e=i.length;for(let t=1;t<n.length;t++){const s=n[t];s.length<e&&(i=s,e=s.length)}return i}function mi(t){return t.every(t=>"記号"===t.pos||t.marked)}async function vi(t,n){const i=await Promise.all(n.map(async t=>await oi(t))),e=await async function(t){const n=new Map,i=[];function e(t){const e=t.filter(t=>0!==t.surface_form.trim().length),s=pi(e);n.has(s)||(n.set(s,e),i.push(e))}for(const n of t)e(n);for(;i.length>0;){const t=i.shift();for(const n of di){const i=await n(t);for(const t of i)e(t)}}const s=Array.from(n.values());return s.sort((t,n)=>pi(t).localeCompare(pi(n))),s}(i),s=e.map(t=>t.map(t=>({surface_form:t.surface_form,reading:t.reading,pos:t.pos,marked:!1})));return{english:t,japanese:n,parsed:s}}
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var ki=function(t,n,i,e){for(var s,r=arguments.length,o=r<3?n:null===e?e=Object.getOwnPropertyDescriptor(n,i):e,c=t.length-1;c>=0;c--)(s=t[c])&&(o=(r<3?s(o):r>3?s(n,i,o):s(n,i))||o);return r>3&&o&&Object.defineProperty(n,i,o),o};let Oi=class extends rt{constructor(){super(...arguments),this.question=null,this.parsedEnglish=[],this._furiganaVisibility=[],this.debug=!1}static{this.styles=r`
    :host {
      display: block;
      border: solid 1px gray;
      padding: 16px;
      max-width: 800px;
      /* Allow both light & dark; rely on page color scheme */
    }

    input#kana-input {
      box-sizing: border-box;
      width: 100%;
      padding-left: 2.5em;
      padding-right: 2.5em;
      border-radius: 8px;

      font-family: 'Noto Sans JP', sans-serif;
      font-size: 22px;
      line-height: 33px;
      text-align: center;
    }

    #english {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 30px;
      text-align: center;
      width: 100%;
      margin-bottom: 10px;
    }

    .english-word[has-furigana] {
      cursor: pointer;
    }

    #skeleton {
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 22px;
      text-align: center;
      width: 100%;
      margin-bottom: 10px;
    }

      #skeleton .skeleton {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.2em;
        flex-wrap: wrap;
      }

      #skeleton .token {
        font-weight: normal;
        color: #999;
      }

      #skeleton .token.marked {
        font-weight: bold;
        color: #000;
      }

      #skeleton .completed {
        color: #4caf50;
        font-size: 1.5em;
        margin-left: 0.3em;
      }

      /* Dark mode adjustments */
      @media (prefers-color-scheme: dark) {
        :host {
          background-color: #121212;
          border-color: #444;
        }
        #skeleton .token.marked {
          color: #eee;
        }
        #skeleton .token {
          color: #888;
        }
        span#english, #english {
          color: #eee;
        }
      }
  `}async supplyQuestion(t){this.question=structuredClone(t),this.parsedEnglish=function(t){const n=/(\w+)\s*(?:\[([^\]]+)\])?/g,i=[];let e;for(;null!==(e=n.exec(t));)i.push({englishWord:e[1],furigana:e[2]||""});return i}(t.english),this._furiganaVisibility=new Array(this.parsedEnglish.length).fill(!1),this.requestUpdate()}render(){return R`
      ${this.parsedEnglish.length>0?R`
            <div id="english" part="english">
              ${this.parsedEnglish.map((t,n)=>R`
                  <span
                    class="english-word"
                    ?has-furigana=${""!==t.furigana}
                    @click=${()=>this._handleEnglishWordClick(n)}
                  >
                    ${this._furiganaVisibility[n]&&t.furigana?R`<ruby
                          ><rb>${t.englishWord}</rb
                          ><rt>${t.furigana}</rt></ruby
                        >`:t.englishWord}
                  </span>
                `)}
            </div>
          `:R`<div id="english" part="english" style="color: #999;">
            Loading question...
          </div>`}
      ${this.question?R`<div id="skeleton" part="skeleton">${this._renderSkeleton()}</div>`:null}
      <input
        id="kana-input"
        part="kana-input"
        type="text"
        autocapitalize="none"
        autocomplete="off"
        spellcheck="false"
        placeholder="日本語"
        @keydown=${this._handleKeydown}
      />
      ${this.debug&&this.question?R`<div id="debug-output" part="debug" style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px; font-family: monospace; font-size: 14px;">
            ${this._renderDebugInfo()}
          </div>`:null}
    `}firstUpdated(){const t=this.renderRoot.querySelector("#kana-input");t&&un(t,{IMEMode:!0})}_handleKeydown(t){if(!this.question||"Enter"!==t.key)return;const n=this.question.parsed;if(mi(bi(n)))return void this.dispatchEvent(new CustomEvent("request-next-question",{bubbles:!0,composed:!0}));const i=t.target,e=yi(n,Cn(i.value));if(e.some(t=>null!==t.matched&&t.matched.length>0)){i.value="";mi(bi(n))&&(console.log("Question completed!"),this.requestUpdate())}else console.log("No match found");this.requestUpdate()}_handleEnglishWordClick(t){this.parsedEnglish&&this.parsedEnglish[t]&&this.parsedEnglish[t].furigana&&t<this._furiganaVisibility.length&&(this._furiganaVisibility[t]=!this._furiganaVisibility[t]),this.requestUpdate()}_renderSkeleton(){if(!this.question)return R`<div>Loading question...</div>`;const t=bi(this.question.parsed),n=mi(t);return R`
      <div class="skeleton">
        ${t.map(t=>"記号"===t.pos?R`${t.surface_form}`:R`<span class="token ${t.marked?"marked":""}"
                  >${t.marked?t.surface_form:"_".repeat(t.surface_form.length)}</span
                >`)}
        ${n?R`<span class="completed">✓</span>`:""}
      </div>
    `}_renderDebugInfo(){if(!this.question)return R`<div>No question loaded</div>`;const t=this.question.parsed.filter(t=>{const n=t.some(t=>t.marked),i=!t.some(t=>t.marked);return n||i});return R`
      <div style="margin-bottom: 5px; font-weight: bold; color: #666;">
        Debug: ${t.length} possible sentence${1!==t.length?"s":""}
      </div>
      ${t.map((t,n)=>R`
          <div style="padding: 2px 0; color: #333;">
            ${n+1}. ${t.map(t=>t.surface_form).join("")}
          </div>
        `)}
    `}};ki([ht()],Oi.prototype,"question",void 0),ki([ht()],Oi.prototype,"parsedEnglish",void 0),ki([ht()],Oi.prototype,"_furiganaVisibility",void 0),ki([at({type:Boolean})],Oi.prototype,"debug",void 0),Oi=ki([(t=>(n,i)=>{void 0!==i?i.addInitializer(()=>{customElements.define(t,n)}):customElements.define(t,n)})("kana-control")],Oi);export{Oi as KanaControl,vi as makeQuestion};
