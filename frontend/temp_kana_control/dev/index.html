<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>&lt;kana-control> Demo</title>
    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/lit/polyfill-support.js"></script>
    <script type="module" src="../kana-control.js"></script>
    <link rel="stylesheet" href="./dev.css" />
  </head>
  <body>
    <script type="module">
      document.addEventListener('readystatechange', () =>
        console.log('readystatechange:', document.readyState)
      );

      import {makeQuestion} from '../kana-control.js';

      // Wait for DOM to be ready
      window.addEventListener('DOMContentLoaded', async () => {
        const control = document.querySelector('kana-control');
        if (!control) {
          console.error('kana-control element not found!');
          return;
        }

        try {
          console.log('Creating questions...');
          
          // Original questions (full set imported from kana-game)
          const questions = [
            await makeQuestion('I live[すむ] in Seattle[シアトル].', [
              '私 は シアトル に 住んでいます。',
              '私 は シアトル に 住んでる。',
            ]),
            await makeQuestion('I am a student[がくせい].', [
              '私 は 学生 です。',
            ]),
            await makeQuestion('I am a teacher[せんせい].', [
              '私 は 先生 です。',
            ]),
            await makeQuestion('I eat[たべる] sushi[すし] every[まい] day[にち].', [
              '私 は 毎 日 寿司 を 食べます。',
              '私 は 毎 日 寿司 を 食べる。',
            ]),
            await makeQuestion('I can speak[はなす] Japanese[にほんご].', [
              '私 は 日本語 を 話すこと が できます。',
              '私 は 日本語 を 話すこと が できる。',
              '私 は 日本語 が 話せます。',
              '私 は 日本語 が 話せる。',
            ]),
            await makeQuestion('I went[いく] to Tokyo[とうきょう] last year[きょねん].', [
              '私 は 去年 東京 に 行きました。',
              '私 は 去年 東京 に いった。',
            ]),
            await makeQuestion('I am reading[よむ] a book[ほん] right now[いま].', [
              '私 は 今 本 を 読んでいます。',
              '私 は 今 本 を 読んでいる。',
            ]),
            await makeQuestion('I want to go[いく] to Japan[にほん].', [
              '私 は 日本 に 行きたい です。',
            ]),
            
            // Additional questions to cover all augmenters in augment.ts:
            
            // Augmenters: 私 variants, だった↔でした (past copula compound tokens)
            await makeQuestion('I was a teacher[せんせい].', [
              '私 は 先生 でし た。',
            ]),
            
            // Augmenters: 私 variants, る→ない (verb negatives), ます forms
            await makeQuestion('I do not eat[たべる] meat[にく].', [
              '私 は 肉 は 食べ ませ ん。',
            ]),
            
            // Augmenters: 私 variants, と思う↔って思う (quotation contraction), ます↔dictionary
            await makeQuestion('I think[おもう] that[という] it is good[いい].', [
              '私 は いい と 思い ます。',
            ]),
            
            // Augmenters: という↔っていう with 言う, ます forms
            await makeQuestion('She says[いう] that[という] she is busy[いそがしい].', [
              '彼女 は 忙しい と 言い ます。',
            ]),
            
            // Augmenters: では↔じゃ (contraction), ではない↔です (copula negative)
            await makeQuestion('That is not a cat[ねこ].', [
              'それ は 猫 では あり ませ ん。',
            ]),
            
            // Augmenters: あなた↔君, ている↔てる, ます forms
            await makeQuestion('Do you know[しる]?', [
              'あなた は 知っ て い ます か。',
            ]),
          ];

          console.log('Questions created:', questions);

          let currentIndex = 0; // start from first question

          // Load first question
          console.log('Loading first question...');
          await control.supplyQuestion(questions[currentIndex]);
          console.log('First question loaded. parsedEnglish:', control.parsedEnglish);
          
          // Enable debug mode
          control.debug = true;

          // Button to cycle through questions
          const nextBtn = document.getElementById('next-question');
          const advanceQuestion = async () => {
            currentIndex = (currentIndex + 1) % questions.length;
            console.log('Loading question', currentIndex);
            await control.supplyQuestion(questions[currentIndex]);
          };

          if (nextBtn) {
            nextBtn.addEventListener('click', advanceQuestion);
          }
          
          // Listen for request-next-question event from the component
          control.addEventListener('request-next-question', () => {
            console.log('Received request-next-question event');
            advanceQuestion();
          });

          console.log('Questions loaded. Click words with furigana to toggle pronunciation hints!');
        } catch (error) {
          console.error('Failed to create questions:', error);
          alert('Failed to load questions. Check console for details. Error: ' + error.message);
        }
      });
    </script>
    
    <div class="hint">
      <button id="next-question">Next Question</button>
    </div>

    <div class="demo">
      <kana-control></kana-control>
    </div>


    <pre id="debug" hidden></pre>
  </body>
</html>
